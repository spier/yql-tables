<?xml version="1.0" encoding="UTF-8" ?>
<table xmlns="http://query.yahooapis.com/v1/schema/table.xsd">
  <meta>
      <author>Sebastian Spier (http://twitter.com/#!/sebastianspier/)</author>
      <description>Mashup of topsy.com, klout.com, peerindex.net</description>
      <documentationURL></documentationURL>
      <sampleQuery></sampleQuery>
  </meta>
  <bindings>
    <select itemPath="" produces="JSON">
      <urls>
        <url></url>
      </urls>
      <inputs>
					<key id="username" type="xs:string" paramType="variable" required="true"/>
          <key id="klout_api_key" type="xs:string" paramType="variable" required="true"/>
					<key id="peerindex_api_key" type="xs:string" paramType="variable" required="true"/>
      </inputs>
      <execute><![CDATA[
				// query APIs
				klout_response = y.query('SELECT * FROM klout.user.show WHERE users=@username AND api_key=@api_key',{api_key:klout_api_key,username:username});
				peerindex_response = y.query('SELECT * FROM peerindex.profile WHERE id=@username AND api_key=@api_key',{api_key:peerindex_api_key,username:username});
				y.log(klout_response);
				y.log(peerindex_response);
				
				y.log( y.xmlToJson(klout_response) );
				
				// construct respon
				root = <root><klout></klout><peerindex></peerindex></root>;
				root.node += <klout></klout>;
				root.node += <peerindex></peerindex>;
				//root.klout += klout_response;
				//root.klout.appendChild( klout_response.results );;
				//root.peerindex += peerindex_response.results..*;			
				y.log(root);
				
				// return results
				default xml namespace = '';
				response.object = root;
	
      ]]></execute>
    </select>
  </bindings>
</table>