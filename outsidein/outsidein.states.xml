<?xml version="1.0" encoding="UTF-8"?>
<table xmlns="http://query.yahooapis.com/v1/schema/table.xsd" https="true">
	<meta>
		<author>Sebastian Spier (http://twitter.com/#!/sebastianspier/)</author>
		<description>Outside.in Hyperlocal News API</description>
		<documentationURL>http://developers.outside.in/docs/read/stories_query_resource</documentationURL>
		<sampleQuery>SELECT * FROM {table} WHERE dev_key="a" AND secret="b" AND state="florida"</sampleQuery>
	</meta>
	<bindings>
		<select itemPath="json" produces="JSON">
			<urls>
				<!-- http://hyperlocal-api.outside.in/v1.1/states/{state abbreviation}/stories?dev_key={key}&sig={signature} -->
				<url>http://hyperlocal-api.outside.in/v1.1/states/{state}/stories</url>
			</urls>
			<inputs>
				<key id="dev_key" type="xs:string" paramType="variable" required="true" />
				<key id="secret" type="xs:string" paramType="variable" required="true" />
				
				<!-- either abbreviation or name of state -->
				<key id="state" type="xs:string" paramType="path" required="true"/>
			</inputs>
			<execute><![CDATA[
				
				// MD5 hashing from crypto-js
				y.include("http://crypto-js.googlecode.com/files/2.3.0-crypto-md5.js");
		
				// create signature
				var hm = dev_key + secret + (Math.round(new Date().getTime() / 1000).toString());
				y.log(hm);

				var sig = y.crypto.encodeMd5(hm);
				y.log(sig);
				
				var sig2 = Crypto.MD5(hm, {asString: true});
				y.log(sig2);
				
				// make request
				response.object = request.query("dev_key",dev_key).query("sig",sig2).get().response;

				]]></execute>
			</select>
		</bindings>
	</table>